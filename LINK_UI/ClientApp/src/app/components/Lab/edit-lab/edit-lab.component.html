<div class="main-wrapper">
  <div class="wrapper dashboard-wrapper">
    <div class="my-container">
      <div class="master-body">
        <div class="title-container">
            <div class="header-back-button" *ngIf="fromSummary && !loading && !_saveloader">
                <img src="assets/images/back-red.png" alt="back" (click)="this.return('labsearch/lab-summary');">
                </div>
          <h3 class="main-title">
            {{ 'EDIT_LAB.TITLE' | translate }}
          </h3>
        </div>
        <div class="content-container">
          <h4 class="container-head">{{ 'EDIT_LAB.LBL_MAIN' | translate }}</h4>
          <div class="formPadding">
            <div class="row">
              <div class="col-sm-3">
                <div class="my-input-group">
                  <label class="required">{{ 'EDIT_LAB.LBL_NAME' | translate }}</label>
                  <input [(ngModel)]="model.name" [ngClass]="{ 'is-invalid':  !validator.isValid('name')}" type="text"
                    maxlength="200" placeholder="{{ 'EDIT_LAB.PH_NAME' | translate }}" />
                  <div *ngIf="!validator.isValid('name')" class="invalid-feedback">
                    <div *ngFor="let error of validator.getErrors('name')">{{ error | translate }}</div>
                  </div>
                </div>
              </div>
              <div class="col-sm-3 mobile-margin-top-15">
                <div class="my-input-group">
                  <label>{{ 'EDIT_LAB.LBL_LOCALLANGUAGE' | translate }}</label>
                  <input [(ngModel)]="model.locLanguageName" type="text" maxlength="200"
                    placeholder="{{ 'EDIT_LAB.LBL_LOCALLANGUAGE' | translate }}">
                </div>
              </div>
              <div class="col-sm-3 mobile-margin-top-15">
                <div class="my-input-group">
                  <label >{{ 'EDIT_LAB.LBL_EMAIL' | translate }}</label>
                  <input [(ngModel)]="model.email" type="text"
                    maxlength="100" placeholder="{{ 'EDIT_LAB.LBL_EMAIL' | translate }}" [ngClass]="{ 'is-invalid':  !validator.isValid('email')}"><!-- -->
                  <div *ngIf="!validator.isValid('email')" class="invalid-feedback">
                    <div *ngFor="let error of validator.getErrors('email')">{{ error | translate }}</div>
                  </div>
                </div>
              </div>
              <div class="col-sm-3 mobile-margin-top-15">
                <div class="my-input-group">
                  <label>{{ 'EDIT_LAB.LBL_PHONE' | translate }}</label>
                  <input [(ngModel)]="model.phone" type="text" maxlength="100"
                  placeholder="{{ 'EDIT_LAB.LBL_PHONE' | translate }}">
                </div>
              </div>
            </div>
            <div class="row marginTop15">
              <div class="col-sm-3">
                <div class="my-input-group">
                  <label>{{ 'EDIT_LAB.LBL_FAX' | translate }}</label>
                  <input [(ngModel)]="model.fax" type="text" maxlength="200"
                    placeholder="{{ 'EDIT_LAB.LBL_FAX' | translate }}">
                </div>
              </div>
              <div class="col-sm-3 mobile-margin-top-15">
                <div class="my-input-group">
                  <label>{{ 'EDIT_LAB.LBL_MOBILE' | translate }}</label>
                  <input [(ngModel)]="model.mobile" type="text" maxlength="20"
                    placeholder="{{ 'EDIT_LAB.LBL_MOBILE' | translate }}">
                </div>
              </div>
              <div class="col-sm-3">
                <div class="my-input-group mobile-margin-top-15">
                  <label>{{ 'EDIT_LAB.LBL_WEBSITE' | translate }}</label>
                  <input type="text" [(ngModel)]="model.webSite" maxlength="200"
                    placeholder="{{ 'EDIT_LAB.LBL_WEBSITE' | translate }}">
                </div>
              </div>
              <div class="col-sm-3">
                <div class="my-input-group mobile-margin-top-15">
                  <label class="required">{{ 'EDIT_LAB.LBL_TYPE' | translate }}</label>
                  <ng-select [items]="mainTypeList" [multiple]="false" [closeOnSelect]="true" [searchable]="true"
                    bindLabel="type" bindValue="id" [loading]="mainTypeLoading"
                    [ngClass]="{ 'is-invalid':  !validator.isValid('typeId')}"
                    placeholder="--- {{ 'EDIT_LAB.LBL_SELECT' | translate }} ---" [(ngModel)]="model.typeId">
                  </ng-select>
                  <div *ngIf="!validator.isValid('typeId')" class="invalid-feedback">
                    <div *ngFor="let error of validator.getErrors('typeId')">{{ error | translate }}</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="row marginTop15">
              <div class="col-sm-3">
                <div class="my-input-group">
                  <label class="required">{{ 'EDIT_LAB.LBL_CONTACTPERSON' | translate }}</label>
                  <input type="text" [(ngModel)]="model.contactPersonName"
                    [ngClass]="{ 'is-invalid':  !validator.isValid('contactPersonName')}" maxlength="200"
                    placeholder="{{ 'EDIT_LAB.LBL_CONTACTPERSON' | translate }}">
                  <div *ngIf="!validator.isValid('contactPersonName')" class="invalid-feedback">
                    <div *ngFor="let error of validator.getErrors('contactPersonName')">{{ error | translate }}</div>
                  </div>
                </div>
              </div>
              <div class="col-sm-3 mobile-margin-top-15">
                <div class="my-input-group">
                  <label>{{ 'EDIT_LAB.LBL_CODE' | translate }}</label>
                  <input type="text" [(ngModel)]="model.glCode" maxlength="500"
                    placeholder="{{ 'EDIT_LAB.LBL_CODE' | translate }}">
                </div>
              </div>
              <div class="col-sm-3 mobile-margin-top-15">
                <div class="my-input-group">
                  <label>{{ 'EDIT_LAB.LBL_LEGALNAME' | translate }}</label>
                  <input type="text" [(ngModel)]="model.legalName" maxlength="200"
                    placeholder="{{ 'EDIT_LAB.LBL_LEGALNAME' | translate }}">
                </div>
              </div>
            </div>
            <div class="row marginTop25">
              <div class="col-sm-12">
                <div class="my-input-group">
                  <label>{{ 'EDIT_LAB.LBL_COMMENT' | translate }}</label>
                  <textarea class="width-180" [(ngModel)]="model.comment" class="form-control" maxlength="200"
                    placeholder="{{ 'EDIT_LAB.LBL_COMMENT' | translate }}"></textarea>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-container">
            <ul class="tab-switch-container">
              <li class="active" (click)="toggleTab($event, 'tab1')">{{ 'EDIT_LAB.TAB_ADDRESS' | translate }}</li>
              <li (click)="toggleTab($event, 'tab2')">{{ 'EDIT_LAB.TAB_CUSTOMER' | translate }}</li>
              <li (click)="toggleTab($event, 'tab3')">{{ 'EDIT_LAB.TAB_CONTACTS' | translate }}</li>
            </ul>
            <div class="tab-content-container">
              <div class="tab-content active" id="tab1">
                <div class="table-action mobile-action desktop-hide tablet-hide">
                  <button class="secondary-cta x-small" (click)="addAddress()">
                    +
                    {{ 'EDIT_LAB.LBL_ADD' | translate }}
                  </button>
                </div>
                <table class="info-table" cellspacing="0">
                  <thead>
                    <tr>
                      <th class="required">{{ 'EDIT_LAB.LBL_ADDRESS' | translate }}</th>
                      <th class="required">{{ 'EDIT_LAB.LBL_LOCALLANGUAGEADR' | translate }}</th>
                      <th class="required">{{ 'EDIT_LAB.LBL_ZIPCODE' | translate }}</th>
                      <th class="required">{{ 'EDIT_LAB.LBL_COUNTRY' | translate }}</th>
                      <th class="required">{{ 'EDIT_LAB.LBL_REGION' | translate }}</th>
                      <th class="required">{{ 'EDIT_LAB.LBL_CITY' | translate }}</th>
                      <th class="required">{{ 'EDIT_LAB.LBL_OFFICETYPE' | translate }}</th>
                      <th *ngIf="isEdit"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of addressValidators;  let i = index">
                      <td>
                        <div class="my-input-group mobile-margin-top-15">
                          <label class="required" for="">{{ 'EDIT_LAB.LBL_ADDRESS' | translate }}</label>
                          <textarea class="width-180" [(ngModel)]="item.address.way"
                            [ngClass]="{ 'is-invalid':!item.validator.isValid('way')}" maxlength="1500"
                            placeholder="{{ 'EDIT_LAB.LBL_ADDRESS' | translate }}"></textarea>
                          <div *ngIf="!item.validator.isValid('way')" class="invalid-feedback">
                            <div *ngFor="let error of item.validator.getErrors('way')">{{ error | translate }}</div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="my-input-group mobile-margin-top-15" >
                          <label class="required" for="">{{ 'EDIT_LAB.LBL_LOCALLANGUAGEADR' | translate }}</label>
                          <textarea class="width-180" [(ngModel)]="item.address.localLanguage"
                            [ngClass]="{ 'is-invalid':!item.validator.isValid('localLanguage')}" maxlength="1500"
                            placeholder="{{ 'EDIT_LAB.LBL_LOCALLANGUAGEADR' | translate }}"></textarea>
                          <div *ngIf="!item.validator.isValid('localLanguage')" class="invalid-feedback">
                            <div *ngFor="let error of item.validator.getErrors('localLanguage')">
                              {{ error | translate }}
                            </div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="my-input-group mobile-margin-top-15">
                          <label class="required" for="">{{ 'EDIT_LAB.LBL_ZIPCODE' | translate }}</label>
                          <input class="width-100" type="text" [(ngModel)]="item.address.zipCode"
                            [ngClass]="{ 'is-invalid':!item.validator.isValid('zipCode')}" maxlength="20"
                            placeholder="{{ 'EDIT_LAB.LBL_ZIPCODE' | translate }}">
                          <div *ngIf="!item.validator.isValid('zipCode')" class="invalid-feedback">
                            <div *ngFor="let error of item.validator.getErrors('zipCode')">{{ error | translate }}</div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="my-input-group mobile-margin-top-15">
                          <label class="required" for="">{{ 'EDIT_LAB.LBL_COUNTRY' | translate }}</label>
                          <ng-select appendTo="body" class="width-180"
                            [ngClass]="{ 'is-invalid':!item.validator.isValid('countryId')}"
                            (ngModelChange)="refreshRegions($event, item.address)" [items]="countryList" 
                            [multiple]="false" [closeOnSelect]="true" [searchable]="true" bindLabel="countryName"
                            bindValue="id" [loading]="countryLoading" placeholder="--- {{ 'EDIT_LAB.LBL_SELECT' | translate }} ---"
                            [(ngModel)]="item.address.countryId">
                          </ng-select>
                          <div *ngIf="!item.validator.isValid('countryId')" class="invalid-feedback">
                            <div *ngFor="let error of item.validator.getErrors('countryId')">
                              {{ error | translate }}
                            </div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="my-input-group mobile-margin-top-15">
                          <label class="required" for="">{{ 'EDIT_LAB.LBL_REGION' | translate }}</label>
                          <ng-select appendTo="body" class="width-180"
                            [ngClass]="{ 'is-invalid':!item.validator.isValid('regionId')}"
                            (ngModelChange)="refreshCities($event, item.address)" [items]="item.address.regionList"
                            [multiple]="false" [closeOnSelect]="true" [searchable]="true" bindLabel="name"
                            bindValue="id" [loading]="" placeholder="--- {{ 'EDIT_LAB.LBL_SELECT' | translate }} ---"
                            [(ngModel)]="item.address.regionId">
                          </ng-select>
                          <div *ngIf="!item.validator.isValid('regionId')" class="invalid-feedback">
                            <div *ngFor="let error of item.validator.getErrors('regionId')">
                              {{ error | translate }}
                            </div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="my-input-group mobile-margin-top-15">
                          <label class="required" for="">{{ 'EDIT_LAB.LBL_CITY' | translate }}</label>
                          <ng-select appendTo="body" class="width-180"
                            [ngClass]="{ 'is-invalid':!item.validator.isValid('cityId')}"
                            [items]="item.address.cityList" [multiple]="false" [closeOnSelect]="true"
                            [searchable]="true" bindLabel="name" bindValue="id" [loading]=""
                            placeholder="--- {{ 'EDIT_LAB.LBL_SELECT' | translate }} ---"
                            [(ngModel)]="item.address.cityId">
                          </ng-select>

                          <div *ngIf="!item.validator.isValid('cityId')" class="invalid-feedback">
                            <div *ngFor="let error of item.validator.getErrors('cityId')">{{ error | translate }}</div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="my-input-group mobile-margin-top-15">
                          <label class="required" for="">{{ 'EDIT_LAB.LBL_OFFICETYPE' | translate }}</label>
                          <ng-select appendTo="body" class="width-180" [items]="addressTypeList" [multiple]="false"
                            [closeOnSelect]="true" [searchable]="true" bindLabel="addressType" bindValue="id"
                            [loading]="addressTypeLoading" placeholder="--- {{ 'EDIT_LAB.LBL_SELECT' | translate }} ---"
                            [ngClass]="{ 'is-invalid':!item.validator.isValid('addressTypeId')}"
                            [(ngModel)]="item.address.addressTypeId">
                          </ng-select>
                          <div *ngIf="!item.validator.isValid('addressTypeId')" class="invalid-feedback">
                            <div *ngFor="let error of item.validator.getErrors('addressTypeId')">{{ error | translate }}</div>
                          </div>
                        </div>
                      </td>
                      <td *ngIf="isEdit">
                        <div class="my-input-group">
                          <button *ngIf="i>0" (click)="removeAddress(i)" class="secondary-cta small">
                            <i class="fa fa-trash"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <div class="table-action mobile-hide">
                  <span>
                    <button class="secondary-cta x-small" (click)="addAddress()">
                      +
                      {{ 'EDIT_LAB.LBL_ADD' | translate }}
                    </button>
                  </span>
                </div>
              </div>
              <div class="tab-content" id="tab2">
                <div class="row">
                  <div class="col-sm-3">
                    <div class="my-input-group mobile-margin-top-15">
                      <label class="required">{{ 'EDIT_LAB.LBL_CUSTOMER' | translate }}</label>
                      <ng-select appendTo="body" [items]="customerMasterList" [multiple]="true" [closeOnSelect]="false"
                        [searchable]="true" bindLabel="name" [loading]="customerLoading"
                        placeholder="--- {{ 'EDIT_LAB.LBL_SELECT' | translate }} ---" [(ngModel)]="selectedCustomerList"
                        (change)="addCustomer()" class="multiple">
                      </ng-select>
                    </div>
                  </div>
                </div>
                <div class="row col-sm-6">
                  <div *ngIf="!checkCustomer()" class="invalid-feedback">
                    <div>{{ 'EDIT_LAB.MSG_CUSTOMER_REQ' | translate }}</div>
                  </div>
                </div>
                <div class="table-container">
                  <table class="pagination-table">
                    <thead>
                      <tr>
                        <th>{{ 'EDIT_LAB.LBL_CUSTOMER' | translate }}</th>
                        <th>{{ 'EDIT_LAB.LBL_CUSTCODE' | translate }}</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let item of model.customerList; let i =index">
                        <td>{{item.name}}</td>
                        <td>
                          <input type="text" [(ngModel)]="item.code" maxlength="200" class="width-140"
                            placeholder="{{ 'EDIT_LAB.LBL_CUSTCODE' | translate }}">
                        </td>
                        <td>
                          <button (click)="removeCustomer(i)" class="secondary-cta x-small">
                            <i class="fa fa-trash"></i>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="tab-content" id="tab3">
                <div class="table-action mobile-action desktop-hide tablet-hide">
                  <button class="secondary-cta x-small" (click)="addContact()">
                    +
                    {{ 'EDIT_LAB.LBL_ADD' | translate }}
                  </button>
                </div>
                <table class="info-table" cellspacing="0">
                  <thead>
                    <tr>
                      <th class="required">{{ 'EDIT_LAB.LBL_NAME' | translate }}</th>
                      <th>{{ 'EDIT_LAB.LBL_EMAIL' | translate }}</th>
                      <th class="required">{{ 'EDIT_LAB.LBL_CUSTOMERS' | translate }}</th>
                      <th>{{ 'EDIT_LAB.LBL_JOBTITLE' | translate }}</th>
                      <th>{{ 'EDIT_LAB.LBL_PHONE' | translate }}</th>
                      <th>{{ 'EDIT_LAB.LBL_FAX' | translate }}</th>
                      <th hidden=true>{{ 'EDIT_LAB.LBL_MOBILE' | translate }}</th>
                      <th>{{ 'EDIT_LAB.LBL_COMMENT' | translate }}</th>
                      <th *ngIf="isEdit"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of contactValidators;  let i = index">
                      <td>
                        <div class="my-input-group mobile-margin-top-15">
                          <label class="required" for="">{{ 'EDIT_LAB.LBL_NAME' | translate }}</label>
                          <input class="width-180" type="text" [(ngModel)]="item.customerContact.contactName"
                            [ngClass]="{ 'is-invalid':!item.validator.isValid('contactName')}" maxlength="200"
                            placeholder="{{ 'EDIT_LAB.LBL_NAME' | translate }}">
                          <div *ngIf="!item.validator.isValid('contactName')" class="invalid-feedback">
                            <div *ngFor="let error of item.validator.getErrors('contactName')">
                              {{ error | translate }}
                            </div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="my-input-group mobile-margin-top-15">
                          <label  class="required" for="">{{ 'EDIT_LAB.LBL_EMAIL' | translate }}</label>
                          <input class="width-180" type="text" [(ngModel)]="item.customerContact.contactEmail"
                            [ngClass]="{ 'is-invalid':!item.validator.isValid('contactEmail')}" maxlength="100"
                            placeholder="{{ 'EDIT_LAB.LBL_EMAIL' | translate }}">
                          <div *ngIf="!item.validator.isValid('contactEmail')" class="invalid-feedback">
                            <div *ngFor="let error of item.validator.getErrors('contactEmail')">
                              {{ error | translate }}
                            </div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="my-input-group mobile-margin-top-15">
                          <label class="required" for="">{{ 'EDIT_LAB.LBL_CUSTOMERS' | translate }}</label>
                          <ng-select class="width-180 multiple" [items]="model.customerList" [multiple]="true"
                            [closeOnSelect]="false" [searchable]="true" bindLabel="name"
                            placeholder="--- {{ 'EDIT_LAB.LBL_SELECT' | translate }} ---"
                            [(ngModel)]="item.customerContact.customerList"
                            [ngClass]="{ 'is-invalid': !item.validator.isValid('customerList')}">
                          </ng-select>
                          <div *ngIf="!item.validator.isValid('customerList')" class="invalid-feedback">
                            <div *ngFor="let error of item.validator.getErrors('customerList')">
                              {{ error | translate }}
                            </div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="my-input-group mobile-margin-top-15">
                          <label for="">{{ 'EDIT_LAB.LBL_JOBTITLE' | translate }}</label>
                          <input class="width-140" type="text" [(ngModel)]="item.customerContact.jobTitle"
                            maxlength="250" placeholder="{{ 'EDIT_LAB.LBL_JOBTITLE' | translate }}">
                        </div>
                      </td>
                      <td>
                        <div class="my-input-group mobile-margin-top-15">
                          <label for="">{{ 'EDIT_LAB.LBL_PHONE' | translate }}</label>
                          <input class="width-180" type="text" [(ngModel)]="item.customerContact.phone" maxlength="100"
                            placeholder="{{ 'EDIT_LAB.LBL_PHONE' | translate }}">
                        </div>
                      </td>
                      <td>
                        <div class="my-input-group mobile-margin-top-15">
                          <label for="">{{ 'EDIT_LAB.LBL_FAX' | translate }}</label>
                          <input class="width-140" type="text" [(ngModel)]="item.customerContact.fax" maxlength="200"
                            placeholder="{{ 'EDIT_LAB.LBL_FAX' | translate }}">
                        </div>
                      </td>
                      <td  hidden=true>
                        <div class="my-input-group mobile-margin-top-15">
                          <label for="">{{ 'EDIT_LAB.LBL_MOBILE' | translate }}</label>
                          <input class="width-180" type="text" [(ngModel)]="item.customerContact.mobile" maxlength="20"
                            placeholder="{{ 'EDIT_LAB.LBL_MOBILE' | translate }}">
                        </div>
                      </td>
                      <td>
                        <div class="my-input-group mobile-margin-top-15">
                          <label for="">{{ 'EDIT_LAB.LBL_COMMENT' | translate }}</label>
                          <input class="width-180" type="text" [(ngModel)]="item.customerContact.comment"
                            maxlength="200" placeholder="{{ 'EDIT_LAB.LBL_COMMENT' | translate }}">
                        </div>
                      </td>

                      <td *ngIf="isEdit">
                        <div class="my-input-group">
                          <button *ngIf="i>0" (click)="removeContact(i)" class="secondary-cta small">
                            <i class="fa fa-trash"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <div class="table-action mobile-hide">
                  <span>
                    <button class="secondary-cta x-small" (click)="addContact()">
                      +
                      {{ 'EDIT_LAB.LBL_ADD' | translate }}
                    </button>
                  </span>
                </div>
              </div>
            </div>
          </div>
          <div class="form-action-container">
          <!--   <button *ngIf="fromSummary" type="button" class="secondary-cta small" [disabled]="loading || _saveloader"
              (click)="this.return('labsearch/lab-summary');">
              {{
                    'EDIT_CITY.LBL_RETURN' | translate
              }}
            </button> -->
            <button class="primary-cta small" (click)="save()" [disabled]="loading || _saveloader">
              {{
                'EDIT_LAB.LBL_SAVE' | translate
              }}
              <span *ngIf="_saveloader">
                <i class="fa fa-refresh fa-spin" aria-hidden="true"></i>
              </span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>